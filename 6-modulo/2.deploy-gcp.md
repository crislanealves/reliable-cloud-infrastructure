# Plataformas de deploy do GCP

Vejamos outras plataformas de deploy: GKE, Cloud Run, App Engine e Cloud Functions.

O Google Kubernetes Engine (GKE) fornece um ambiente gerenciado para deploy, gerenciamento e escalonamento de aplicativos em contêineres na infraestrutura do Google. O ambiente do GKE consiste em várias máquinas virtuais do Compute Engine agrupadas para formar um cluster. Os clusters do GKE são fornecidos pelo sistema de gerenciamento de cluster de código aberto Kubernetes. O Kubernetes oferece os mecanismos para interagir com o cluster. 

Comandos e recursos do Kubernetes são usados para deploy e gerenciar aplicativos, realizar tarefas de administração e definir políticas, além de monitorar a integridade das cargas de trabalho deployadas. Este diagrama à direita mostra o layout de um cluster do Kubernetes. Um cluster consiste em pelo menos um plano de controle do cluster e várias máquinas de worker chamadas de nós. O plano de controle e as máquinas de nó executam o sistema de orquestração de cluster Kubernetes. Pods são os menores e mais básicos objetos deploy no Kubernetes. Um pod representa uma única instância de um processo em execução em um cluster. Os pods contêm um ou mais contêineres, como os do Docker, que executam os serviços sendo deployados. É possível otimizar o uso de recursos deploy vários serviços no mesmo cluster.

O Cloud Run, por outro lado, permite que você faça deploy de contêineres em um cluster do Kubernetes gerenciado pelo Google. Uma grande vantagem é que você não precisa gerenciar ou configurar o cluster. Os serviços deploy devem ser sem estado e as imagens usadas devem estar no Container Registry. O Cloud Run pode ser usado para automatizar o deploy nos clusters do Anthos GKE. Faça isso se precisar de mais controle sobre os serviços, porque ele permite que você acesse sua rede VPC, ajuste o tamanho de instâncias de computação e execute os serviços em todas as regiões do GKE. A captura de tela à direita exibe uma configuração do Cloud Run em que o URL da imagem de contêiner é especificado com a plataforma de deploy, que pode ser o Cloud Run totalmente gerenciado ou o Cloud Run for Anthos.

O App Engine é uma plataforma sem servidor totalmente gerenciada para criar e fazer deploy de aplicativos. Os aplicativos podem ser escalonados de zero para cima sem ter que se preocupar com o gerenciamento da infraestrutura. O App Engine foi criado para microsserviços. Na configuração, cada projeto do Google Cloud pode conter um aplicativo do App Engine, sendo que um aplicativo tem um ou mais serviços. Cada serviço tem uma ou mais versões e cada versão tem uma ou mais instâncias. O App Engine tem suporte à divisão de tráfego. Isso sdeploy a troca de versões e estratégias, como os testes canário ou testes A/B. O diagrama à direita mostra a organização de nível superior de um projeto do Google Cloud com dois serviços, sendo que cada serviço tem duas versões. Esses serviços são deploy e controláveis de maneira independente.

Vamos ver uma arquitetura de microsserviços típica do App Engine. Um bom exemplo é um varejista que faz vendas on-line. Aqui o App Engine funciona como o front-end para clientes da Web e dispositivos móveis. O back-end deste aplicativo é uma variedade de soluções de armazenamento do Google Cloud com conteúdo estático, como imagens armazenadas no Cloud Storage, Cloud SQL usado para dados relacionais estruturados, como dados do cliente e dados de venda, e o Firestore usado para armazenamento NoSQL, como dados do produto. Um benefício do Firestore é a possibilidade de sincronização com aplicativos clientes. O Memcache é usado para reduzir a carga nos repositórios de dados armazenando consultas em cache. As tarefas do Cloud são usadas para realizar trabalhos de maneira assíncrona fora de uma solicitação do usuário ou solicitação de serviço. Há também um aplicativo de lote que gera relatórios de dados para gerenciamento. As funções do Cloud são ótimas para deploy microsserviços acoplados com flexibilidade e orientados por eventos. Elas foram criadas para processar eventos ocorridos no Google Cloud. As funções podem ser acionadas por mudanças em um bucket do Cloud Storage, uma mensagem do Pub/Sub ou solicitações HTTP. A plataforma é totalmente gerenciada, escalonável e econômica. Se não houver solicitações, você não paga nada, e o processamento é pago pelo tempo de execução em incrementos de 100 ms. Este gráfico ilustra um serviço de tradução de imagens deploy com o Cloud Functions. Quando uma imagem é enviada a um bucket do Cloud Storage, a função OCR do Cloud é acionada. Ela identifica o texto na imagem usando a API Cloud Vision do Google. Depois da identificação do texto, este serviço publica uma mensagem para um tema do Pub/Sub para tradução, que aciona outra função do Cloud que traduzirá o texto identificado na imagem usando a API Cloud Translation. Em seguida, a função de tradução do Cloud publicará uma mensagem em um tema de gravação de arquivos no Pub/Sub, que aciona uma função que vai gravar a imagem traduzida em um arquivo. Essa sequência ilustra um típico caso de uso do Cloud Functions para processamento baseado em eventos.
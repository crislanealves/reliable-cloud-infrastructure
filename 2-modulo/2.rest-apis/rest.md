# REST

Vamos falar sobre projeto de microsserviços baseados em REST e HTTP para alcançar serviços independentes acoplados com flexibilidade. Um dos aspectos mais importantes de aplicativos baseados em microsserviços é a capacidade de implantar microsserviços totalmente independentes um do outro. Para alcançar essa independência, cada microsserviço fornece um contrato com controle de versões para os clientes, que são outros microsserviços ou aplicativos. Os serviços não podem quebrar esses contratos com controle de versão até ser conhecido que nenhum outro microsserviço dependa de um contrato com controle de versão em particular. Lembre-se que outros microsserviços talvez precisem reverter para uma versão de código anterior que exija um contrato anterior. Lembre-se disso nas políticas de suspensão de uso e descontinuação.

Uma cultura que englobe contratos fortes e com versão talvez seja o aspecto organizacional mais desafiador de um aplicativo estável baseado em microsserviços. No nível mais baixo dos detalhes, os serviços se comunicam usando HTTPS com payloads em texto, como JSON ou XML, e usam verbos HTTP, como GET e POST, para dar significado às ações solicitadas. Os clientes precisam saber apenas os detalhes mínimos para usar o serviço: o URI, a solicitação e os formatos de mensagem da resposta. A arquitetura REST é compatível com acoplamento flexível. Em inglês, REST quer dizer "transferência de estado representativo" e tem independência de protocolo. HTTP é o protocolo mais comum, mas gRPC também é muito usado. REST é compatível com acoplamento flexível, mas ainda exige práticas de engenharia fortes para manter o acoplamento flexível.

Um ponto de partida é ter um contrato forte. Implementações com base em HTTP podem usar uma API aberta padrão. O gRPC fornece buffers de protocolo. Para ajudar a manter o acomplamento flexível, é essencial manter compatibilidade com versões anteriores do contrato e projetar uma API que englobe um domínio, e não casos de uso ou clientes específicos. Se não fizer isso, cada caso de uso novo ou aplicativo exigirá outra API REST especial, seja qual for o protocolo. Processamento de resposta de solicitação é o caso de uso comum, mas streaming também pode ser necessário e pode influenciar a escolha do protocolo. O gRPC é compatível com streaming, por exemplo.

Os recursos são identificados por URIs ou endpoints, e as respostas às solicitações retornam uma representação imutável das informações do recurso. Aplicações REST precisam fornecer interfaces uniformes consistentes e podem vincular a recursos adicionais. Hypermedia como o mecanismo do estado do aplicativo é um componente do REST, com o qual o cliente não precisa de muito conhecimento sobre um serviço, porque links para outros recursos são fornecidos como parte das respostas. É importante que o projeto da API seja parte do processo de desenvolvimento. O ideal é adotar um conjunto de regras de projeto para que as APIs REST tenham uma interface uniforme. Por exemplo, informar erros, ter a estrutura dos URLs, e usar paginação de maneiras consistentes. Além disso, considere armazenar em cache para mais desempenho e otimização de recursos para recursos imutáveis.

No REST, cliente e servidor trocam representações de um recurso. Um recurso é uma noção abstrata de informações. A representação de um recurso é uma cópia das informações dele. Por exemplo, um recurso pode representar um cão. A representação de um recurso são os dados reais de um cão. Por exemplo, o Noir, que é um Schnoodle, ou o Bree, que é um Mutt. Duas representações distintas de um recurso. O URI fornece acesso a um recurso. Fazer uma solicitação para esse recurso retorna uma representação dele, geralmente no formato JSON. O recurso solicitado pode ser de itens individuais ou uma coleção de itens. Por motivos de desempenho, é melhor retornar coleções de itens em vez de itens individuais. Esses tipos de operações geralmente são chamadas de APIs de lote. A representação de um recurso entre cliente e serviços é alcançada usando formatos padrões baseados em texto. JSON é a norma para formatos baseados em texto, mas XML também pode ser usado. Para APIs públicas ou externas, JSON é o padrão. Para serviços internos, gRPC pode ser usado, em especial se desempenho for essencial.

# HTTP

Um cliente acessa formulários de serviço HTTP e solicitações de HTTP. Solicitações HTTP são criadas em três partes: a linha da solicitação, as variáveis de cabeçalho e o corpo da solicitação. A linha da solicitação tem o verbo HTTP, GET, POST, PUT etc., bem como o URI solicitado e o protocolo da versão. As variáveis de cabeçalho contêm pares de chave-valor. Alguns são padrões, como agente do usuário, que ajuda o destinatário a identificar o agente de software solicitante. Metadados sobre o formato da mensagem ou os formatos da mensagem preferidos também são incluídos aqui para os serviços REST baseados em HTTPS. É possível adicionar cabeçalhos personalizados.

O corpo da solicitação contém dados que serão enviados para o servidor e é relevante apenas para comandos HTTP que enviam dados, como POST e PUT. Aqui, vemos dois exemplos de mensagens com base em texto do cliente HTTP. O primeiro exemplo mostra uma solicitação HTTP GET para o URL usando HTTP versão 1.1. Há uma variável de cabeçalho de solicitação chamada "host" com o valor `pets.drehnstrom.co`. O segundo exemplo mostra uma solicitação HTTP POST para o URL /add usando HTTP versão 1.1. Há três variáveis de cabeçalho de solicitação: host; tipo de conteúdo, definido como JSON; e comprimento do conteúdo, definido como 35 bytes. Há um corpo de solicitação, que tem o documento JSON, `{name: Noir, breed: Schnoodle}`. Isso representa o pet sendo adicionado.

Como parte de uma solicitação, o verbo HTTP diz para o servidor qual ação realizar em um recurso. HTTP como um protocolo fornece nove verbos, mas, geralmente, apenas os quatro listados aqui são usados no REST. GET é usado para recuperar recursos. POST é usado para solicitar a criação de um novo recurso. Então, o serviço cria o recurso e geralmente retorna o ID exclusivo gerado do novo recurso ao cliente. PUT é usado para criar um novo recurso ou alterar um recurso existente. A solicitação PUT precisa ser idempotente, ou seja, não importa quantas vezes a solicitação seja feita pelo cliente a um recurso, os efeitos do recurso sempre são exatamente os mesmos. Por fim, a solicitação DELETE é usada para remover um recurso.

Serviços HTTP retornam respostas em um formato padrão definido por HTTP. Essas respostas HTTP são criadas em três partes: a linha da resposta, as variáveis de cabeçalho e o corpo da resposta. A linha da resposta tem a versão do HTTP e um código de resposta. Os códigos de resposta são divididos em limites na casa de centenas. O intervalo 200 significa OK. Por exemplo, 200 é OK, 201 quer dizer que um recurso foi criado. O intervalo 400 significa que a solicitação do cliente tem um erro. Por exemplo, 403 significa "proibido" porque a solicitação não tem permissão. 404 significa que o recurso não foi encontrado. O intervalo 500 significa que o servidor encontrou um erro e não pode processar a solicitação. Por exemplo, 500 é o "erro interno do servidor". 503 quer dizer "não disponível", geralmente porque o servidor está sobrecarregado.

O cabeçalho da resposta é um conjunto de pares de chave-valor, como tipo de conteúdo, que indica para o destinatário o tipo de conteúdo contido no corpo da resposta. O corpo da resposta contém uma representação de recurso solicitada no formato especificado no cabeçalho de tipo de conteúdo, e pode ser JSON, XML, HTML etc. As diretrizes listadas aqui focam em alcançar consistência na API. Substantivos singulares precisam ser usados para recursos individuais, e substantivos plurais, para coleções ou conjuntos. Por exemplo, considere o seguinte URI /pet. Então, uma solicitação GET para o URI /pet/1 busca um pet com o ID 1, já GET/pets busca todos os pets. Não use URIs como GET/GETpets. O URI precisa referenciar o recurso, e não a ação no recurso. Esse é o papel do verbo. Lembre-se que URIs não diferenciam maiúsculas de minúsculas e incluem informações da versão.

É uma prática recomendada fazer diagramas dos serviços. Este diagrama mostra que há um serviço que fornece acesso ao recurso chamado "pets". A representação desse recurso é o pet. Quando uma solicitação é feita para o recurso pelo serviço, uma ou mais representações de um pet é retornada.
# Segurança da rede

No módulo anterior, discutimos conceitos de redes, mas não exploramos a fundo os princípios de segurança de rede. Vamos aprofundar esses conceitos agora.

Em primeiro lugar, é altamente recomendável remover os IPs externos sempre que possível para evitar o acesso a máquinas que estejam fora da sua rede. Existem várias opções disponíveis para garantir a comunicação segura com VMs que não possuem endereços IP públicos. Essas VMs podem ser destinadas a serem consumidas por outras instâncias dentro do projeto ou por meio de opções de interconexões dedicadas.

Para acessar VMs sem endereços IP externos, você pode considerar o uso de um "Bastion Host" para permitir acesso externo a máquinas privadas. Outra opção é o "Identity-Aware Proxy" (IAP) para habilitar o acesso SSH ou o "Cloud NAT" para fornecer conectividade à Internet para máquinas internas.

Independentemente do método escolhido, é importante que todo o tráfego da Internet passe por um balanceador de carga, firewall, API Gateway ou Cloud IAP. Dessa forma, os serviços internos não têm IPs públicos nem podem ser acessados diretamente. O diagrama à direita ilustra um cliente externo acessando recursos do Google Compute Engine usando um Bastion Host, protegido por um firewall que controla o acesso.

Para as instâncias de VM que têm apenas endereços IP internos, é possível usar o "Acesso Privado do Google" para acessar serviços do Google que possuem endereços IP externos. O diagrama à direita demonstra uma instância do Compute Engine acessando um bucket do Cloud Storage usando seu próprio endereço IP interno. Certifique-se de ativar o "Acesso Privado do Google" ao criar a sub-rede, seja por meio do comando gcloud exibido aqui ou pelo Console do Cloud.

Independentemente de as instâncias de VM terem endereços IP públicos ou não, é fundamental configurar regras de firewall para controlar o acesso. Por padrão, todas as portas de entrada são bloqueadas e a saída é permitida. É de responsabilidade do administrador definir regras de firewall que permitam ou bloqueiem o acesso a instâncias específicas com base em intervalos de IP, protocolos e portas. A imagem mostra alguns cenários em que as regras de firewall podem ser aplicadas, incluindo saída do Compute Engine para servidores externos e comunicação entre instâncias da VM.

Lembre-se de que a segurança no nível do aplicativo é responsabilidade sua. Se precisar gerenciar APIs, uma opção é usar o "Cloud Endpoints". Essa ferramenta é um gateway de gerenciamento de APIs que ajuda no desenvolvimento, implantação e gerenciamento de APIs em qualquer back-end do Google Cloud. Com o Cloud Endpoints, você pode proteger e monitorar suas APIs públicas, controlar o acesso usando autenticação, como Auth0, e validar todas as chamadas com um JSON Web Token assinado por uma chave privada da conta de serviço. O Cloud Endpoints também pode ser integrado ao "Identity Platform" para autenticação. É importante mencionar que todos os endpoints de serviço do Google Cloud utilizam HTTPS.

Recomenda-se o uso de TLS (Transport Layer Security) para os endpoints de serviço, e é responsabilidade do administrador configurar esses endpoints para suportar TLS. Ao configurar balanceadores de carga, crie apenas front-ends seguros. A caixa de diálogo mostra a configuração de um front-end com o protocolo HTTPS selecionado e um certificado associado.

O Google oferece suporte para a proteção contra ataques distribuídos de negação de serviço (DDoS) usando balanceadores de carga globais no tráfego de níveis três e quatro. Ativando o CDN (Content Delivery Network), você também protege os recursos de back-end, uma vez que um ataque DDoS resulta em uma ocorrência em cache, em vez de afetar diretamente os recursos, como mostrado à direita.

O "Google Cloud Armor" é uma solução adicional de segurança que pode ser utilizada para criar políticas de segurança de rede. Com o Cloud Armor, você pode criar listas de permissões para permitir endereços conhecidos e necessários, bem como listas de bloqueio para impedir o acesso de invasores conhecidos. A caixa de diálogo ilustra uma configuração comum de política de segurança que pode ser selecionada como uma lista de permissões ou bloqueio, com uma regra que define a ação a ser tomada em caso de bloqueio, como um erro 403.

Além da proteção nas camadas três e quatro, o Google Cloud Armor oferece suporte para regras de aplicação na camada sete. Isso inclui regras predefinidas para detecção de scripts maliciosos, ataques de Cross-Site Scripting (XSS) e injeção de SQL. O Cloud Armor também disponibiliza uma linguagem de regras para filtrar o tráfego de solicitações. Por exemplo, a primeira expressão deste slide verifica se o IP de origem na solicitação está dentro do intervalo 9.9.9.0/24. Outras expressões verificam a presença de cookies específicos no cabeçalho da solicitação ou o código da região de origem. Essas expressões podem ser combinadas logicamente usando os operadores "AND" e "OR" e são atribuídas a uma regra de permissão ou bloqueio que é aplicada ao tráfego de entrada.

---